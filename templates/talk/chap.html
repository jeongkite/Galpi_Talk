{% extends '../base.html' %}
{% block content %}
{% load regex_func %}

<section class="chapter chap_{{chapter.chap_num}}">
    <div class="chap-header">

        <div onclick="chap_back({{chapter.chap_num}})"><img src="/static/img/icon/Arrow-Back-White.svg" alt=""></div>
        <div>
            <h3 class="white-text">{{ chapter.title }}</h3>
            <a href=""><img src="" alt=""></a>
        </div>
        <div onclick="chap_next({{chapter.chap_num }})"><img src="/static/img/icon/Arrow-Next-White.svg" alt=""></div>
    </div>

    {% if chapter.content %}
    <div class="center-flex">
        <div class="notice bubble">{{ chapter.content }}</div>
    </div>
    {% endif %}

    {% if question %}
        
    {% else %}
        {% for bubble in bubbles %}
            <div class="your_bubble">
                <img class="your-profile-img" src="/static/img/icon/Profile-{{chapter.chap_num}}.svg" alt="">
                {% with bubble.0.content|split as contentNs %}
                    {% for contentN in contentNs  %}
                        <div  class="past your bubble">{{ contentN }}</div>
                    {% endfor %}
                {% endwith %}
                {% if bubble.0.star %}
                <img src="/static/img/icon/Star-Icon.svg" alt="">
                {% endif %}
            </div>
            <div class="my_bubble">
                <a class="past my " href="{% url 'talk:update_answer' bubble.1.id %}"><img src="/static/img/icon/Edit-Button.svg" alt=""></a>
                {% if bubble.1.content|regex_func %}
                <img class="past img-bubble" src="/static/img/choice/{{bubble.1.content}}.png" alt="">
                {% else %}
                <div class="past my bubble">{{ bubble.1.content }}</div>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}

    {% if this_q %}
    
    <div class="your_bubble">
        <img class="your-profile-img" src="/static/img/icon/Profile-{{chapter.chap_num}}.svg" alt="">
        {% with this_q.content|split as contentNs %}
            {% for contentN in contentNs  %}
                <div  class="your bubble">{{ contentN }}</div>
            {% endfor %}
        {% endwith %}
    </div>
    {% endif %}
    <form action="{% url 'talk:chap' qn=qn %}" method="POST">
    {% csrf_token %}
    {% if this_q.id == 50 %}
        <a href="{% url 'talk:chapter50'%}">연락처 입력하기</a>
    {% elif this_q.id == 51 %}
        <a href="{% url 'talk:chapter51'%}">유언장 쓰러가기</a>
    {% elif this_q.q_type == 1  %}
        {% for choice in this_q.choice_set.all %}
            {% if choice.content|regex_func %}
            <button class=" img-bubble-choice" name="answer" id="answer" value="{{ choice.content }}"><img src="/static/img/choice/{{choice.content}}.png" alt=""></button>
            {% else %}
            <button class="bubble my choice-bubble " name="answer" id="answer" value="{{ choice.content }}">{{ choice.content }}</button>
            {% endif %}
        {% endfor %}
    {% else %}
    <div class="chapter-form">
        <input maxlength="{{this_q.limit}}" type="text" id="answer" name="answer" onkeypress="countLength(this, {{this_q.limit}})">
        <input type="text" id="limit" readonly><br>
        <button class="send" type="submit"><img src="/static/img/icon/send-button.svg" alt=""></button>
    </div>
    {% endif %}
    </form>
</section>


{% endblock %}